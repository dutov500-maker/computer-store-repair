# 🏗️ Архитектура проекта

## 📊 Текущая архитектура (на poehali.dev)

```
┌─────────────────────────────────────────────────────────────┐
│                         ПОЛЬЗОВАТЕЛЬ                        │
│                      (Браузер Chrome/Safari)                │
└──────────────────────┬──────────────────────────────────────┘
                       │
                       │ HTTPS
                       ↓
┌─────────────────────────────────────────────────────────────┐
│                    FRONTEND (React SPA)                     │
│                      poehali.dev CDN                        │
│  ┌─────────────┐  ┌──────────────┐  ┌──────────────┐      │
│  │  Главная    │  │   Каталог    │  │  Портфолио   │      │
│  │   Home.tsx  │  │ Catalog.tsx  │  │Portfolio.tsx │      │
│  └─────────────┘  └──────────────┘  └──────────────┘      │
│  ┌─────────────┐  ┌──────────────┐  ┌──────────────┐      │
│  │  Контакты   │  │  Админка     │  │  Компоненты  │      │
│  │Contacts.tsx │  │  Admin.tsx   │  │  UI Library  │      │
│  └─────────────┘  └──────────────┘  └──────────────┘      │
└──────────────────────┬──────────────────────────────────────┘
                       │
                       │ REST API (JSON)
                       ↓
┌─────────────────────────────────────────────────────────────┐
│              BACKEND (Cloud Functions)                      │
│                    poehali.dev                              │
│                                                             │
│  ┌──────────────────────────────────────────────────────┐  │
│  │  /api (Python)                                       │  │
│  │  • GET /api?type=catalog    - Список товаров        │  │
│  │  • POST /api?type=catalog&action=create             │  │
│  │  • GET /api?type=portfolio  - Список работ          │  │
│  │  • POST /api?type=portfolio&action=update           │  │
│  └──────────────────────────────────────────────────────┘  │
│                                                             │
│  ┌──────────────────────────────────────────────────────┐  │
│  │  /submit-request (Python)                            │  │
│  │  • POST /submit-request - Прием заявок              │  │
│  │  • Отправка в Telegram                              │  │
│  │  • Сохранение в БД                                  │  │
│  └──────────────────────────────────────────────────────┘  │
│                                                             │
│  ┌──────────────────────────────────────────────────────┐  │
│  │  /admin-requests (Python)                            │  │
│  │  • GET /admin-requests - Список заявок для админа   │  │
│  └──────────────────────────────────────────────────────┘  │
└──────────────────────┬──────────────────────────────────────┘
                       │
                       │ PostgreSQL Protocol
                       ↓
┌─────────────────────────────────────────────────────────────┐
│               DATABASE (PostgreSQL)                         │
│                    poehali.dev                              │
│                                                             │
│  ┌─────────────┐  ┌──────────────┐  ┌──────────────┐      │
│  │  catalog    │  │   orders     │  │  portfolio   │      │
│  │  (14 rows)  │  │   (1 row)    │  │  (10 rows)   │      │
│  └─────────────┘  └──────────────┘  └──────────────┘      │
│  ┌─────────────┐  ┌──────────────┐  ┌──────────────┐      │
│  │  services   │  │   repairs    │  │   settings   │      │
│  │  (9 rows)   │  │   (6 rows)   │  │   (1 row)    │      │
│  └─────────────┘  └──────────────┘  └──────────────┘      │
└─────────────────────────────────────────────────────────────┘
```

---

## 🔄 Рекомендуемая архитектура (гибридная)

```
┌─────────────────────────────────────────────────────────────┐
│                         ПОЛЬЗОВАТЕЛЬ                        │
│                      (Браузер Chrome/Safari)                │
└────────────┬────────────────────────────────────────────────┘
             │
             ├─────────► Frontend (статика)
             │           REG.RU
             │           ~15ms
             │
             └─────────► Backend API
                         poehali.dev
                         ~30ms

┌─────────────────────────────────────────────────────────────┐
│                    FRONTEND (Static Files)                  │
│                     REG.RU Хостинг                          │
│                 (Москва, Виртуальный хостинг)               │
│                                                             │
│  /public_html/                                              │
│  ├── index.html          ← Главная страница                │
│  ├── .htaccess           ← Конфигурация Apache             │
│  └── assets/             ← CSS, JS, Изображения            │
│      ├── index-xxx.js    ← React приложение (bundle)       │
│      ├── index-xxx.css   ← Стили Tailwind                  │
│      └── fonts/          ← Шрифты                          │
│                                                             │
│  Стоимость: ~100₽/мес                                      │
└──────────────────────┬──────────────────────────────────────┘
                       │
                       │ AJAX/Fetch запросы
                       │ https://functions.poehali.dev/xxx
                       ↓
┌─────────────────────────────────────────────────────────────┐
│              BACKEND (Cloud Functions)                      │
│                    poehali.dev                              │
│              (Автоматическое масштабирование)               │
│                                                             │
│  [Всё как в текущей архитектуре]                           │
│                                                             │
│  Стоимость: 0₽ (бесплатно)                                 │
└──────────────────────┬──────────────────────────────────────┘
                       │
                       ↓
┌─────────────────────────────────────────────────────────────┐
│               DATABASE (PostgreSQL)                         │
│                    poehali.dev                              │
│                                                             │
│  [Всё как в текущей архитектуре]                           │
│                                                             │
│  Стоимость: 0₽ (бесплатно)                                 │
└─────────────────────────────────────────────────────────────┘
```

**ИТОГО:** 100₽/мес + 0 забот о backend

---

## 🖥️ Альтернативная архитектура (всё на VPS)

```
┌─────────────────────────────────────────────────────────────┐
│                         ПОЛЬЗОВАТЕЛЬ                        │
└──────────────────────┬──────────────────────────────────────┘
                       │
                       │ HTTPS (через Nginx)
                       ↓
┌─────────────────────────────────────────────────────────────┐
│                    VPS REG.RU (Ubuntu 22.04)                │
│                     2GB RAM, 2 CPU, 20GB SSD                │
│                                                             │
│  ┌─────────────────────────────────────────────────────┐   │
│  │  NGINX (Reverse Proxy)                              │   │
│  │  • Раздает статику (frontend)                       │   │
│  │  • Проксирует API на FastAPI                        │   │
│  │  • SSL сертификаты (Let's Encrypt)                  │   │
│  └──────────────────┬──────────────────────────────────┘   │
│                     │                                       │
│  ┌─────────────────▼──────────────────────────────────┐   │
│  │  FRONTEND (Static)                                  │   │
│  │  /var/www/html/                                     │   │
│  │  • index.html                                       │   │
│  │  • assets/                                          │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                             │
│  ┌─────────────────────────────────────────────────────┐   │
│  │  FASTAPI (Python 3.11)                              │   │
│  │  /var/www/backend/                                  │   │
│  │  • Запускается через uvicorn                        │   │
│  │  • Управляется через Supervisor                     │   │
│  │  • Порт 8000 (внутренний)                          │   │
│  └──────────────────┬──────────────────────────────────┘   │
│                     │                                       │
│  ┌─────────────────▼──────────────────────────────────┐   │
│  │  POSTGRESQL 14                                      │   │
│  │  • База данных: computer_store                      │   │
│  │  • Пользователь: store_user                        │   │
│  │  • Порт 5432 (локальный)                           │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                             │
│  Стоимость: ~400₽/мес                                      │
└─────────────────────────────────────────────────────────────┘
```

---

## 📊 Сравнение производительности

### Время отклика (типичное)

#### Гибридная архитектура:
```
Пользователь → REG.RU (frontend)
  └─► HTML/CSS/JS загрузка: ~100-300ms (первая загрузка)
  └─► Статика из кэша: ~10-50ms

Пользователь → poehali.dev (backend)
  └─► API запросы: ~30-80ms
  └─► Запросы к БД: +10-20ms
```

**Общее время загрузки страницы:** 150-400ms (отлично)

#### VPS архитектура:
```
Пользователь → VPS REG.RU
  └─► HTML/CSS/JS: ~80-200ms
  └─► API запросы: ~10-30ms (локальные)
  └─► Запросы к БД: +5-10ms (локальные)
```

**Общее время загрузки страницы:** 100-250ms (на 50-150ms быстрее)

**Вывод:** Разница незаметна для пользователей (0.05-0.15 сек)

---

## 🔒 Безопасность

### Гибридная архитектура:
- ✅ HTTPS на frontend (REG.RU)
- ✅ HTTPS на backend (poehali.dev)
- ✅ Автоматические обновления безопасности
- ✅ Изоляция функций (контейнеры)
- ✅ Автоматические SSL сертификаты
- ✅ DDoS защита (встроенная)
- ⚠️ Зависимость от poehali.dev

### VPS архитектура:
- ✅ Полный контроль
- ✅ HTTPS (Let's Encrypt)
- ⚠️ Ручные обновления безопасности
- ⚠️ Настройка firewall вручную
- ⚠️ Мониторинг вручную
- ⚠️ Резервное копирование вручную

---

## 💰 Стоимость владения (TCO)

### Гибридная (1 год):
```
REG.RU хостинг:        100₽ × 12 = 1,200₽
Backend poehali.dev:          0₽ = 0₽
БД poehali.dev:               0₽ = 0₽
Домен .ru (опционально):           200₽
──────────────────────────────────────
ИТОГО:                              1,400₽/год
```

### VPS (1 год):
```
VPS 2GB:               400₽ × 12 = 4,800₽
Домен .ru:                           200₽
──────────────────────────────────────
ИТОГО:                              5,000₽/год

+ Время на администрирование: ~2 часа/месяц
```

**Экономия гибридной архитектуры:** 3,600₽/год

---

## 🎯 Рекомендация по архитектуре

### ✅ Используйте гибридную для:
- Стартапов и MVP
- Малого и среднего бизнеса
- Проектов с нагрузкой <10,000 запросов/день
- Ограниченного бюджета
- Быстрого запуска

### ⚙️ Используйте VPS для:
- Высоконагруженных проектов (>10,000 req/day)
- Корпоративных требований
- Специфических библиотек/зависимостей
- Полного контроля над инфраструктурой
- Интеграции с локальными сервисами

---

## 📈 Масштабирование

### Гибридная:
- ✅ Автоматическое масштабирование backend
- ✅ CDN для статики (опционально)
- ⚠️ Ограничения платформы poehali.dev

### VPS:
- ⚠️ Вертикальное масштабирование (увеличение мощности VPS)
- ⚠️ Горизонтальное масштабирование (несколько серверов)
- ✅ Полный контроль над ресурсами

---

## 🔧 Поддержка и обслуживание

### Гибридная:
- ✅ Не требуется (автоматически)
- ✅ Обновления применяются автоматически
- ✅ Мониторинг встроен
- ✅ Резервное копирование автоматическое

### VPS:
- ⚠️ Обновления ОС вручную (apt update)
- ⚠️ Обновления зависимостей вручную
- ⚠️ Настройка мониторинга (Grafana/Prometheus)
- ⚠️ Настройка бэкапов (cron/rsync)
- ⚠️ Проверка логов вручную

**Время на обслуживание VPS:** 2-4 часа/месяц

---

**Для вашего проекта рекомендуется гибридная архитектура** 🎯
